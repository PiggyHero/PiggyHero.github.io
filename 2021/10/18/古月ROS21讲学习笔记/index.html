<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学习《古月ROS入门21讲》的学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="古月ROS21讲学习笔记">
<meta property="og:url" content="http://example.com/2021/10/18/%E5%8F%A4%E6%9C%88ROS21%E8%AE%B2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="PiggyHero Wiki">
<meta property="og:description" content="学习《古月ROS入门21讲》的学习笔记">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055135.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055137.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055141.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055153.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055200.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055205.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055209.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055214.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055219.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055223.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055230.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055236.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055240.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055247.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055316.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055335.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055339.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055352.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055356.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055411.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055437.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055509.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055909.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055903.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055601.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055606.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055617.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055634.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055638.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055644.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055649.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055707.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055714.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055717.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055724.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055729.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055732.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055751.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055810.png">
<meta property="og:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055801.png">
<meta property="article:published_time" content="2021-10-17T22:00:58.000Z">
<meta property="article:modified_time" content="2021-10-18T15:59:56.286Z">
<meta property="article:author" content="PiggyHero">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055135.png">

<link rel="canonical" href="http://example.com/2021/10/18/%E5%8F%A4%E6%9C%88ROS21%E8%AE%B2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>古月ROS21讲学习笔记 | PiggyHero Wiki</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/PiggyHero" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">PiggyHero Wiki</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/18/%E5%8F%A4%E6%9C%88ROS21%E8%AE%B2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cutexiaoxin.gif">
      <meta itemprop="name" content="PiggyHero">
      <meta itemprop="description" content="不学习咋整啊！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PiggyHero Wiki">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          古月ROS21讲学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-10-18 06:00:58 / 修改时间：23:59:56" itemprop="dateCreated datePublished" datetime="2021-10-18T06:00:58+08:00">2021-10-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">软件实践</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>学习《古月ROS入门21讲》的学习笔记<br><span id="more"></span><br>课程总览：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055135.png" alt="image-20211007012207647"></p>
<h1 id="一、ROS是什么"><a href="#一、ROS是什么" class="headerlink" title="一、ROS是什么"></a>一、ROS是什么</h1><p>ROS1.0发布于2010年，其发布的根本目的就是在机器人开发过程中，提高代码的复用率。就是在开发一个机器人时，可以通过ROS提供的各种功能，驱动机器人移动，感知外部环境，做出决策等。这就极大的节省了机器人开发的时间。</p>
<p>ROS(Robot operation system)全名为机器人操作系统，具体的它包括四大部分，分别为<strong>通信机制，开发工具，应用功能和生态系统</strong>。</p>
<h2 id="1-通信机制"><a href="#1-通信机制" class="headerlink" title="1.通信机制"></a>1.通信机制</h2><p>ROS提供了一种松耦合分布式通信机制，机器人的内部各个模块可以依靠这种通信机制完成信息的传递。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055137.png" alt="image-20211005000749206" style="zoom:67%;" /></p>
<h2 id="2-开发工具"><a href="#2-开发工具" class="headerlink" title="2.开发工具"></a>2.开发工具</h2><p>ROS提供了一系列的开发工具，可以为机器人开发提供很大的帮助。</p>
<p>常用的开发工具有TF坐标变换，QT工具箱，Rviz，Gazebo。会在后面进行具体的使用介绍。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055141.png" alt="image-20211005000718567"></p>
<h2 id="3-应用功能"><a href="#3-应用功能" class="headerlink" title="3.应用功能"></a>3.应用功能</h2><p>ROS中包含各种功能包，可供机器人开发中使用。例如有可以驱动相机的功能包，有进行图像处理的功能包，有控制机器人运动的功能包，还有SLAM功能包。这些功能包的存在可以大大简化机器人的开发过程。</p>
<h2 id="4-生态环境"><a href="#4-生态环境" class="headerlink" title="4.生态环境"></a>4.生态环境</h2><p>ROS的生态环境具体指的是依据ROS系统，建立起来的一个ROS社区，在这个社区中，包含着我们需要的各种东西。主要有以下几部分组成：</p>
<ul>
<li>发行版：ROS发行版包括一系列带有版本号，可以直接安装的功能包。</li>
<li>软件源：ROS依赖于共享网络上的开源代码，不同组织机构可以开发或共享自己的机器人软件。</li>
<li>ROS wiki：记录ROS信息文档的论坛。</li>
<li>ROs Answer：咨询ROS相关的网站。</li>
</ul>
<h1 id="二、ROS中的核心概念"><a href="#二、ROS中的核心概念" class="headerlink" title="二、ROS中的核心概念"></a>二、ROS中的核心概念</h1><p>从上一章所知，ROS主要有四部分组成，包括通信机制，开发工具，应用功能和生态环境。抛开生态环境不说，因为整个ROS生态环境是当我们遇到困难或有什么特殊需求的时候，寻求帮助的地方。在我们实际的开发中，我们需要非常了解前三个部分。</p>
<p>下面我们来细细的说明一下ROS中的核心概念。</p>
<h2 id="1-组成ROS的基本单元"><a href="#1-组成ROS的基本单元" class="headerlink" title="1.组成ROS的基本单元"></a>1.组成ROS的基本单元</h2><p>当我们要了解ROS的通信机制时，就要知道是什么和什么在进行通信，也就是通信的主体是什么。在ROS中，通信的主体有节点和节点管理器两部分组成。</p>
<h3 id="1-节点-Node-—工人"><a href="#1-节点-Node-—工人" class="headerlink" title="(1)节点(Node)—工人"></a>(1)节点(Node)—工人</h3><p>节点是ROS系统中最基本的执行单元，有如下特点：</p>
<ul>
<li>节点要执行具体的任务进程，是一个可独立运行的可执行文件。</li>
<li>不同的节点可以使用不同的编程语言，可分布式运行在不同的主机。</li>
<li>节点在系统中的名称必须是唯一的。</li>
</ul>
<h3 id="2-节点管理器-Ros-Master-—管理员"><a href="#2-节点管理器-Ros-Master-—管理员" class="headerlink" title="(2)节点管理器(Ros Master)—管理员"></a>(2)节点管理器(Ros Master)—管理员</h3><p>对于节点的管理工作，需要节点管理器来完成，它主要有如下作用：</p>
<ul>
<li>为节点提供命名和注册服务。</li>
<li>跟踪和记录话题/服务通信（后面会说），辅助节点相互查找、建立连接。</li>
<li>提供参数服务器，节点使用此服务器存储和检索运行时的参数。</li>
</ul>
<p>下面我们用工人和管理员对以上的功能进行类比。对于每一个节点，我们可以把它看成是一个工人。工人就需要做好自己特定的工作（执行具体的任务进程），比如这个工人负责搬砖，另一个工人负责盖楼。不管这个工人来自哪里（使用不同的编程语言），或者在哪个工地（可运行在不同主机），只要能干活就可以。另外，工人不能重名（节点的名称唯一），这样不方便管理员管理。</p>
<p>而对于管理员，首先就是要为工人注册信息，分配工号（为节点提供命名和注册服务），然后给每个工人分配一个工作内容，并记录下工人所汇报的工作情况，方便其他工人了解完成情况（跟踪记录通信，辅助节点查找，建立连接）。另外，管理员还要记录下工程的水泥灰号，垒砖高度等工程参数，以方便工人在工作时可以随时查询（提供参数服务器）。</p>
<h2 id="2-通信机制"><a href="#2-通信机制" class="headerlink" title="2.通信机制"></a>2.通信机制</h2><p>通信机制主要有两种，一种是异步通信机制，叫做话题（Topic），另一种是同步通信机制，叫做服务（Service）。</p>
<h3 id="1-异步通信机制"><a href="#1-异步通信机制" class="headerlink" title="(1)异步通信机制"></a>(1)异步通信机制</h3><p>在该通信机制下，节点间传输的数据不是实时的。我们要知道两个概念：</p>
<h4 id="a-话题-Topic"><a href="#a-话题-Topic" class="headerlink" title="a.话题(Topic)"></a>a.话题(Topic)</h4><ul>
<li>节点间用来传输数据的总线。</li>
<li>使用发布/订阅模型，数据由发布者传输到订阅者，同一个话题的订阅者或发布者可以不唯一。</li>
</ul>
<h4 id="b-消息-Message"><a href="#b-消息-Message" class="headerlink" title="b.消息(Message)"></a>b.消息(Message)</h4><ul>
<li>消息是话题的数据。</li>
<li>具有一定的数据类型和数据结构，包括ROS提供的标准类型和用户自定义类型。</li>
<li>使用与编程语言无关的.msg文件定义，编译过程中生成对应的代码文件。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055153.png" alt="image-20211005005705788"></p>
<p>好了，说完这么抽象的概念，我们还是用一个生活的例子来类比一下。在我们生活中，异步通信机制一个很明显的例子就是Youtube视频。例如有一个篮球话题（Topic），有一群订阅者（subsciber）和一群发布者（publisher）。当某一个发布者发布了一条视频（message）时，订阅者并不会马上知道，而是等他想看的时候，才会查看该话题下的内容，这就是异步通信机制。对于发布的视频的内容结构，可以是先热身，后打球，也可以是先打球，后洗澡，虽然结构可以变，但是有一定结构的。另外，无论视频内容如何，都必须是.avi格式的（.msg）。</p>
<p>所以说话题（Topic）是一个传输数据的总线，也可以理解成一个频道，一个管道，我们订阅了这个频道后，其内容会保持一定的结构，但是会变化。</p>
<p>在ROS中，话题的一个例子如下：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055200.png" alt="image-20211005010719866"></p>
<h3 id="2-同步通信机制"><a href="#2-同步通信机制" class="headerlink" title="(2)同步通信机制"></a>(2)同步通信机制</h3><p>同步通信机制，也叫做服务。它可以保证数据的传递是实时的。它有如下特点：</p>
<ul>
<li>使用客户端/服务器模型，客户端发送请求，服务器完成处理后返回应答数据。</li>
<li>使用与编程语言无关的.srv文件定义请求和应答数据结构，编译过程中生成对应的代码文件。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055205.png" alt="image-20211005011052269" style="zoom: 67%;" /></p>
<p>这就好比一个服务员和一个顾客，顾客首先需要说出一个需求，然后服务员要做出回应。比如，顾客说帮我订一张机票（request），服务员立即定了一张机票然后回复订完了（reponse）。</p>
<p>ROS中服务的一个例子：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055209.png" alt="image-20211005011405078"></p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055214.png" alt="image-20211005011450237" style="zoom:67%;" /></p>
<h2 id="3-参数—全局共享字典"><a href="#3-参数—全局共享字典" class="headerlink" title="3.参数—全局共享字典"></a>3.参数—全局共享字典</h2><p>前面讲了工人和管理员的关系，管理员要记录一些所有工人都要用的信息，例如水泥的灰号。ROS中的参数的功能也是这样。参数由节点管理器提供服务器存储。特点如下：</p>
<ul>
<li>可通过网络访问的共享、多变量字典。</li>
<li>节点可以使用此服务器（也就是字典）来存储和检索运行时的参数。</li>
<li>适合存储静态、非二进制的配置参数，不适合存储动态配置的数据。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055219.png" alt="image-20211005012244569"></p>
<h2 id="4-文件系统"><a href="#4-文件系统" class="headerlink" title="4.文件系统"></a>4.文件系统</h2><p>前面所讲的节点等所有的东西都需要存储在文件中，也就是真实存在的形式。ROS的文件系统由三部分组成。</p>
<h3 id="1-功能包-Package"><a href="#1-功能包-Package" class="headerlink" title="(1)功能包(Package)"></a>(1)功能包(Package)</h3><p>ROS软件中的基本单元，包含节点源码、配置文件、数据定义等。</p>
<h3 id="2-功能包清单-Package-Manifest"><a href="#2-功能包清单-Package-Manifest" class="headerlink" title="(2)功能包清单(Package Manifest)"></a>(2)功能包清单(Package Manifest)</h3><p>记录功能包的基本信息，包含作者信息、许可信息、依赖选项、编译标志等。</p>
<h3 id="3-元功能包-Meta-Package"><a href="#3-元功能包-Meta-Package" class="headerlink" title="(3)元功能包(Meta Package)"></a>(3)元功能包(Meta Package)</h3><p>多个用于同一目的的功能包构成一个元功能包。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055223.png" alt="image-20211005012811067"></p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055230.png" alt="image-20211005012906244"></p>
<h1 id="三、ROS命令行工具"><a href="#三、ROS命令行工具" class="headerlink" title="三、ROS命令行工具"></a>三、ROS命令行工具</h1><p>ROS中提供了命令行工具帮助我们实现各种功能。</p>
<h2 id="1-基本命令"><a href="#1-基本命令" class="headerlink" title="1.基本命令"></a>1.基本命令</h2><p><code>roscore</code>     启动Ros Master（必须启动）。</p>
<p><code>rosrun    功能包名    节点</code>     运行节点，要加功能包名，然后要运行的节点名。</p>
<h2 id="2-节点命令"><a href="#2-节点命令" class="headerlink" title="2.节点命令"></a>2.节点命令</h2><p>以<code>rosnode</code> 开头的命令，是处理节点的命令。</p>
<h3 id="1-rosnode-list"><a href="#1-rosnode-list" class="headerlink" title="(1)rosnode list"></a>(1)<code>rosnode list</code></h3><p>列出当前系统的所有节点。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055236.png" alt="image-20211005015249575"></p>
<p>在这里有一个rosout节点，是默认打开的，该节点主要是接受各个节点的信息形成一个日志信息。</p>
<h3 id="2-rosnode-info-节点名"><a href="#2-rosnode-info-节点名" class="headerlink" title="(2)rosnode info 节点名"></a>(2)<code>rosnode info 节点名</code></h3><p>查看某个节点信息。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055240.png" alt="image-20211005015739389"></p>
<p>在这里显示出的发布或订阅的内容中，前面部分为话题名，后面的是消息名。</p>
<h2 id="3-话题命令"><a href="#3-话题命令" class="headerlink" title="3.话题命令"></a>3.话题命令</h2><p>以<code>rostopic</code> 开头的命令，是处理话题的命令。</p>
<h3 id="1-rostopic-list"><a href="#1-rostopic-list" class="headerlink" title="(1)rostopic list"></a>(1)<code>rostopic list</code></h3><p>查看当前系统的所有话题。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055247.png" alt="image-20211005020128092"></p>
<h3 id="2-rostopic-pub"><a href="#2-rostopic-pub" class="headerlink" title="(2)rostopic pub"></a>(2)<code>rostopic pub</code></h3><p>向话题发布消息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rostopic	 pub 	话题名 	消息名 	内容</span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line">rostopic 	pub 	/turtle1/cmd_vel 	geometry_msgs/Twist 	<span class="string">&quot;消息内容(在这里ROS定义的结构)&quot;</span></span><br></pre></td></tr></table></figure>
<p>在这里，/turtle1/cmd_vel是话题名，geometry_msgs/Twist 是消息内容，后面双引号内是具体的消息内容，消息内容会有特定的结构。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055316.png" alt="image-20211005020805272"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic 	pub 	-r 		10 		话题名		消息名		内容</span><br></pre></td></tr></table></figure>
<p>-r表示发布循环发布，这里表示发布频率为10Hz。</p>
<p>按<code>Ctrl+C</code>可以停止发布。</p>
<h2 id="4-话题消息命令"><a href="#4-话题消息命令" class="headerlink" title="4.话题消息命令"></a>4.话题消息命令</h2><p>以<code>rosmsg</code> 开头的命令，是处理话题消息的命令。</p>
<h3 id="1-rosmsg-show"><a href="#1-rosmsg-show" class="headerlink" title="(1)rosmsg show"></a>(1)<code>rosmsg show</code></h3><p>查看某个消息的数据结构。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosmsg 		show	消息名</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055335.png" alt="image-20211005022203709"></p>
<h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h2 id="5-服务命令"><a href="#5-服务命令" class="headerlink" title="5.服务命令"></a>5.服务命令</h2><p>以<code>rosservice</code> 开头的命令，是处理服务的命令。</p>
<h3 id="1-rosservice-list"><a href="#1-rosservice-list" class="headerlink" title="(1)rosservice list"></a>(1)<code>rosservice list</code></h3><p>查看服务端的服务。也就是查看可提供的服务。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055339.png" alt="image-20211005022505249"></p>
<h3 id="2-rosservice-call"><a href="#2-rosservice-call" class="headerlink" title="(2)rosservice call"></a>(2)<code>rosservice call</code></h3><p>对某个服务发送请求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rosservice		call		可提供服务名		<span class="string">&quot;请求内容&quot;</span></span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">rosservice 		call 		/spawn 		<span class="string">&quot;x: 0.0</span></span><br><span class="line"><span class="string">y: 0.0</span></span><br><span class="line"><span class="string">theta: 0.0</span></span><br><span class="line"><span class="string">name:&#x27;	 &#x27; &quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在这里，服务名为/spawn，双引号内为请求的内容，具有系统定义的数据结构。</p>
<h2 id="6-服务消息命令"><a href="#6-服务消息命令" class="headerlink" title="6.服务消息命令"></a>6.服务消息命令</h2><p>以<code>rossrv</code>开头的命令，是处理服务消息的命令。</p>
<h3 id="1-rossrv-show"><a href="#1-rossrv-show" class="headerlink" title="(1)rossrv show"></a>(1)<code>rossrv show</code></h3><p>查看服务消息数据的内容结构。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rossrv 		show		服务消息名</span><br></pre></td></tr></table></figure>
<p>在标准的服务消息数据中，有—-分隔，在其上面的是request的内容，下面是response的内容。request可以是空的，如果是空的，直接call服务就可以。response能不能是空的还不知道。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055352.png" alt="image-20211006001820657"></p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055356.png" alt="image-20211006001952198"></p>
<h2 id="7-话题记录和复现"><a href="#7-话题记录和复现" class="headerlink" title="7.话题记录和复现"></a>7.话题记录和复现</h2><p>记录当前系统中所有话题的数据并保存下来，然后可以再用的时候复现出来。</p>
<h3 id="1-rosbag-record"><a href="#1-rosbag-record" class="headerlink" title="(1)rosbag record"></a>(1)<code>rosbag record</code></h3><p>记录想要保存的话题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rosbag		record		-a		-O		储存的文件名</span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line">rosbag 		record 		-a		-O		cmd_record</span><br></pre></td></tr></table></figure>
<p>在这里-a表示记录所有话题数据。-O表示保存数据为一个压缩包。</p>
<p>文件会被储存到终端当前的工作目录。</p>
<h3 id="2-rosbag-play"><a href="#2-rosbag-play" class="headerlink" title="(2)rosbag play"></a>(2)<code>rosbag play</code></h3><p>复现保存的话题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rosbag 		play		储存的文件名</span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line">rosbag 		play		cmd_record</span><br></pre></td></tr></table></figure>
<h2 id="8-参数命令"><a href="#8-参数命令" class="headerlink" title="8.参数命令"></a>8.参数命令</h2><p>以<code>rosparam</code> 开头的命令，都是处理参数的命令。</p>
<h3 id="1-rosparam-list"><a href="#1-rosparam-list" class="headerlink" title="(1)rosparam list"></a>(1)<code>rosparam list</code></h3><p>查看当前的全局参数。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055411.png" alt="image-20211006013652641"></p>
<h3 id="2-rosparam-get"><a href="#2-rosparam-get" class="headerlink" title="(2)rosparam get"></a>(2)<code>rosparam get</code></h3><p>获取某个参数的具体值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosparam 	get 	参数名</span><br><span class="line">rosparam 	get 	/run_id</span><br></pre></td></tr></table></figure>
<h3 id="3-rosparam-set"><a href="#3-rosparam-set" class="headerlink" title="(3)rosparam set"></a>(3)<code>rosparam set</code></h3><p>修改某个参数的值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosparam 	<span class="built_in">set</span>		参数名		参数值</span><br><span class="line">rosparam 	<span class="built_in">set</span> 	/turtlesim/background_b		255</span><br></pre></td></tr></table></figure>
<h3 id="4-rosparam-dump"><a href="#4-rosparam-dump" class="headerlink" title="(4)rosparam dump"></a>(4)<code>rosparam dump</code></h3><p>把现在系统中的全局参数保存到一个文件，文件的类型为.yaml，文件存储到终端的当前路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam 	dump 	文件名.yaml</span><br></pre></td></tr></table></figure>
<h3 id="5-rosparam-load"><a href="#5-rosparam-load" class="headerlink" title="(5)rosparam load"></a>(5)<code>rosparam load</code></h3><p>从文件中加载参数，我们可以在文件中修改参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam 	load 	文件名.yaml</span><br></pre></td></tr></table></figure>
<h3 id="6-rosparam-delete"><a href="#6-rosparam-delete" class="headerlink" title="(6)rosparam delete"></a>(6)<code>rosparam delete</code></h3><p>删除某个参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam 	delete 	参数名</span><br></pre></td></tr></table></figure>
<h1 id="四、创建工作空间与功能包"><a href="#四、创建工作空间与功能包" class="headerlink" title="四、创建工作空间与功能包"></a>四、创建工作空间与功能包</h1><p>工作空间是用来存储ROS工程开发相关文件的文件夹。就像我们在使用IDE写代码的时候，首先要建立一个工程文件。</p>
<p>工作空间主要有四个文件夹：</p>
<ul>
<li>src：代码空间，用来放置功能包，所有功能包的代码，配置文件，launch文件存储在该处。</li>
<li>build：编译空间，放置编译过程中产生的中间文件。（一般不用管）</li>
<li>devel：开发空间，放置一些生成的可执行文件，库或脚本。</li>
<li>install：安装空间，安装位置。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055437.png" alt="image-20211005030701463"></p>
<h2 id="1-创建工作空间"><a href="#1-创建工作空间" class="headerlink" title="1.创建工作空间"></a>1.创建工作空间</h2><p>(1)建立工作空间的文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir	-p	~/catkin_Name/src</span><br><span class="line"><span class="built_in">cd</span>		~/catkin_Name/src</span><br><span class="line">catkin_init_workspace</span><br></pre></td></tr></table></figure>
<p>(2)编译工作空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> 		~/catkin_Name/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure>
<p>(3)设置环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span>		devel/setup.bash		</span><br></pre></td></tr></table></figure>
<p>(4)检查环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 	<span class="variable">$ROS_PACKAGE_PATH</span></span><br></pre></td></tr></table></figure>
<h2 id="2-创建功能包"><a href="#2-创建功能包" class="headerlink" title="2.创建功能包"></a>2.创建功能包</h2><p>如果要写代码，必须要创建功能包，因为功能包是ROS里放置源码的最小单元。</p>
<p>创建功能包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> 		~/catkin_Name/src</span><br><span class="line">catkin_create_pkg	功能包名	依赖1		依赖2		……</span><br></pre></td></tr></table></figure>
<p>编译功能包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> 		~/catkin_Name</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span>		~/catkin_Name/devel/setup.bash</span><br></pre></td></tr></table></figure>
<p>注意：同一个工作空间下，不允许存在同名的功能包。</p>
<h1 id="五、话题中各部分的编程实现"><a href="#五、话题中各部分的编程实现" class="headerlink" title="五、话题中各部分的编程实现"></a>五、话题中各部分的编程实现</h1><h2 id="1-发布者编程实现"><a href="#1-发布者编程实现" class="headerlink" title="1.发布者编程实现"></a>1.发布者编程实现</h2><p>之前我们控制的海龟是用键盘控制或者命令行控制，现在我们想通过编写一个程序来控制海龟的运动。这就需要写一个发布者的程序。</p>
<p>我们要清楚的是，发布者应该由节点充当。但是一个节点还可以对很多话题发布数据，所以我们在节点中，定义publisher来代表向一个话题的发布。它们之间的关系如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055505.png" alt="image-20211005164112040"></p>
<p>但容易混淆的是，发布消息的节点本身也可以叫做publisher。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055509.png" alt="image-20211005140716108"></p>
<h3 id="1-编写程序之前"><a href="#1-编写程序之前" class="headerlink" title="(1)编写程序之前"></a>(1)编写程序之前</h3><p>写具体的代码之前，我们要创建好工作空间，这里就不多说了。</p>
<p>然后要创建一个功能包。因为ROS的可执行文件都放在功能包中存储。如第四章第2节所述。功能包在工作空间的src文件夹下。</p>
<p>然后进入功能包，在功能包下的src文件夹中编写代码。</p>
<h3 id="2-代码实现过程"><a href="#2-代码实现过程" class="headerlink" title="(2)代码实现过程"></a>(2)代码实现过程</h3><ul>
<li>初始化ROS节点：在这一步要设置节点的名字。（在这里要注意节点名和可执行文件名的区别，节点可以理解为一个可执行文件，但这个可执行文件有一个名字，这个文件运行后会产生节点，节点也会有一个名字，这两个名字可能会有些不同。例如：在海龟仿真器中，功能包名字为turtlesim，生成节点的可执行文件名为turtlesim_node，运行后产生的节点名字为turtlesim）这里设置的就是运行后的节点名。</li>
<li>创建publisher，</li>
<li>向ROS Master注册节点信息，包括发布的话题名和话题中的消息类型。</li>
<li>创建消息数据。</li>
<li>按照一定频率循环发布的消息。</li>
</ul>
<p>如海龟速度发布程序：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ROS节点初始化</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;velocity_publisher&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建节点句柄，配置节点资源。</span></span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*创建一个Publisher，设置要往哪个话题发布什么样的消息内容。</span></span><br><span class="line"><span class="comment">	一个节点，可以发布不同的内容，用publisher来代表节点中不同的发布内容。</span></span><br><span class="line"><span class="comment"> 	在这里：发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，</span></span><br><span class="line"><span class="comment"> 	队列长度10，不能及时发布的数据就被存在队列中。*/</span></span><br><span class="line">	ros::Publisher turtle_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置循环的频率</span></span><br><span class="line">	<span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">	    <span class="comment">// 初始化geometry_msgs::Twist类型的消息</span></span><br><span class="line">		geometry_msgs::Twist vel_msg;<span class="comment">//数据类型是一个类，创建一个对象</span></span><br><span class="line">		vel_msg.linear.x = <span class="number">0.5</span>;</span><br><span class="line">		vel_msg.angular.z = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line">	    <span class="comment">// 发布消息</span></span><br><span class="line">		turtle_vel_pub.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line">		<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publsh turtle velocity command[%0.2f m/s, %0.2f rad/s]&quot;</span>, </span><br><span class="line">				vel_msg.linear.x, vel_msg.angular.z);</span><br><span class="line"></span><br><span class="line">	    <span class="comment">// 按照循环频率延时</span></span><br><span class="line">	    loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-编译代码"><a href="#3-编译代码" class="headerlink" title="(3)编译代码"></a>(3)编译代码</h3><p>编译代码，需要修改该程序包中的CMakeLists文件。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(可执行文件名 	src/源码名)<span class="comment">#注意这里的可执行文件名就是一会要rosrun 功能包  可执行文件名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(可执行文件名	<span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)<span class="comment">#这里直接用变量代替依赖的库路径，因为前面会自己找到依赖库的路径。</span></span><br></pre></td></tr></table></figure>
<p>然后回到工作空间根目录，用<code>catkin_make</code> 命令完成编译。</p>
<p>生成的可执行文件会在工作空间根目录下的devel/lib中找到。</p>
<h3 id="4-配置环境变量"><a href="#4-配置环境变量" class="headerlink" title="(4)配置环境变量"></a>(4)配置环境变量</h3><p>一定要设置环境变量，要不然系统是找不到这个可执行文件的。设置环境变量的文件是工作空间根目录下的devel中的setup.bash文件。</p>
<p>用下面的命令完成设置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> 		devel/setup.bash</span><br></pre></td></tr></table></figure>
<p>如果想避免重复的设置环境变量，也可以在终端的隐藏文件中设置。</p>
<p>首先打开主文件夹，然后按Ctrl+H快捷键显示隐藏文件，然后打开.bashrc，在最后面写上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> 		/home/pigpighero/工作空间/devel/setup.bash</span><br></pre></td></tr></table></figure>
<h3 id="5-运行"><a href="#5-运行" class="headerlink" title="(5)运行"></a>(5)运行</h3><p>接下来就可以在终端中运行这个发布者节点了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun  	功能包		可执行文件名</span><br></pre></td></tr></table></figure>
<h2 id="2-订阅者编程实现"><a href="#2-订阅者编程实现" class="headerlink" title="2.订阅者编程实现"></a>2.订阅者编程实现</h2><p>现在编程实现一个订阅者节点，和发布者是一样的，我们同样在功能包的src文件中编写代码。</p>
<p>代码的实现过程：</p>
<ul>
<li>初始化ROS节点</li>
<li>订阅需要的话题</li>
<li>循环等待话题消息，接收到消息后进入回调函数</li>
<li>在回调函数中完成消息处理</li>
</ul>
<p>在这里要注意一下回调函数，这和单片机开发中的中断函数类似，在收到消息后，可以立即跳入到回调函数中，完成消息的处理。</p>
<p>以订阅海龟的位置消息为例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">poseCallback</span><span class="params">(<span class="keyword">const</span> turtlesim::Pose::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将接收到的消息打印出来</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;</span>, msg-&gt;x, msg-&gt;y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;pose_subscriber&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Subscriber，订阅名为/turtle1/pose的topic，注册回调函数poseCallback</span></span><br><span class="line">    ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>(<span class="string">&quot;/turtle1/pose&quot;</span>, <span class="number">10</span>, poseCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后同样要注意编写CMakeLists文件和设置环境变量，这里都和前面一样。</p>
<h2 id="3-自定义话题消息结构"><a href="#3-自定义话题消息结构" class="headerlink" title="3.自定义话题消息结构"></a>3.自定义话题消息结构</h2><p>我们之前发布和订阅的话题的消息结构都是定义好的，我们现在自己来完成消息结构的定义。</p>
<p>下面我们用一个实际的例子，按照以下步骤来完成自定义的消息结构：</p>
<h3 id="1-定义msg文件"><a href="#1-定义msg文件" class="headerlink" title="(1)定义msg文件"></a>(1)定义msg文件</h3><p>消息的结构载体为.msg文件，这就是简单的纯文本文件，每一行由字段类型和字段名称组成。</p>
<p>我们首先在功能包中创建一个新的msg文件夹，用来存储所有的消息结构。</p>
<p>我们定义一个人的消息结构在Person.msg文件中：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string 	name</span><br><span class="line">uint8 	sex</span><br><span class="line">uint8 	age</span><br></pre></td></tr></table></figure>
<h3 id="2-编辑配置文件"><a href="#2-编辑配置文件" class="headerlink" title="(2)编辑配置文件"></a>(2)编辑配置文件</h3><p><strong>首先要在package.xml中添加功能包依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055909.png" alt="image-20211005185240266"></p>
<p><strong>然后在CMakeLists添加相关配置</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation <span class="comment">#这个是后加的</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>如下图：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055903.png" alt="image-20211005185707368"></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_message_files(FILES 	Person.msg)<span class="comment">#配置msg源文件</span></span><br><span class="line">generate_messages(DEPENDENCIES		std_msgs)<span class="comment">#生成消息时依赖于std_msgs</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES learning_topic</span></span><br><span class="line">  CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="3-使用"><a href="#3-使用" class="headerlink" title="(3)使用"></a>(3)使用</h3><p>最后就是编译了，在工作空间目录下使用<code>catkin_make</code> 命令完成。生成的文件在devel/include中。</p>
<p>在ROS中，消息的结构需要在发布和订阅消息的时候使用，我们先用一个.msg纯文本文件把消息结构写好，然后通过编译，生成头文件结构，这里面是包含该消息结构的类，我们在编写程序的时候可以直接引用头文件并使用。</p>
<p><strong>person_publisher.cpp:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;learning_topic/Person.h&quot;</span><span class="comment">//这里引用头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_publisher&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span></span><br><span class="line">    ros::Publisher person_info_pub = n.advertise&lt;learning_topic::Person&gt;(<span class="string">&quot;/person_info&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置循环的频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化learning_topic::Person类型的消息</span></span><br><span class="line">    	learning_topic::Person person_msg;</span><br><span class="line">		person_msg.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">		person_msg.age  = <span class="number">18</span>;</span><br><span class="line">		person_msg.sex  = learning_topic::Person::male;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发布消息</span></span><br><span class="line">		person_info_pub.<span class="built_in">publish</span>(person_msg);</span><br><span class="line"></span><br><span class="line">       	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">				  person_msg.name.<span class="built_in">c_str</span>(), person_msg.age, person_msg.sex);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 按照循环频率延时</span></span><br><span class="line">        loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>person_subscriber.cpp:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;learning_topic/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">personInfoCallback</span><span class="params">(<span class="keyword">const</span> learning_topic::Person::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将接收到的消息打印出来</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Subcribe Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">			 msg-&gt;name.<span class="built_in">c_str</span>(), msg-&gt;age, msg-&gt;sex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_subscriber&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span></span><br><span class="line">    ros::Subscriber person_info_sub = n.<span class="built_in">subscribe</span>(<span class="string">&quot;/person_info&quot;</span>, <span class="number">10</span>, personInfoCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译，在CMakeLists中加入：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(person_publisher src/person_publisher.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_publisher <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(person_subscriber src/person_subscriber.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_subscriber <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_subscriber <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055601.png" alt="image-20211005193520292"></p>
<p>注意：在话题通信中，话题的建立是通过建立发布者或订阅者的。比如说上面的Person_publisher.cpp程序中，在建立publisher时，要注明发送的话题，此时便建立了话题。</p>
<h1 id="六、服务中各部分的编程实现"><a href="#六、服务中各部分的编程实现" class="headerlink" title="六、服务中各部分的编程实现"></a>六、服务中各部分的编程实现</h1><h2 id="1-客户端编程实现"><a href="#1-客户端编程实现" class="headerlink" title="1.客户端编程实现"></a>1.客户端编程实现</h2><p>前面我们使用命令行对海龟仿真节点发送了一个请求，又生成了一只海龟，现在我们通过程序来发送请求。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055606.png" alt="image-20211005230349178"></p>
<p>和编写发布者的过程类似，先创建一个新的功能包。在代码实现过程，也是在创建节点的基础上编写请求数据。具体的程序内容主要包括以下部分：</p>
<ul>
<li>初始化ROS节点。</li>
<li>创建一个Client实例。</li>
<li>发布服务请求数据。</li>
<li>等待Server处理之后的应答结果。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;turtlesim/Spawn.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;turtle_spawn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">	ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);<span class="comment">//查询当前系统中是否有spanw服务，如果没有一直等待</span></span><br><span class="line">	ros::ServiceClient add_turtle = node.serviceClient&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化turtlesim::Spawn的请求数据</span></span><br><span class="line">	turtlesim::Spawn srv;</span><br><span class="line">	srv.request.x = <span class="number">2.0</span>;</span><br><span class="line">	srv.request.y = <span class="number">2.0</span>;</span><br><span class="line">	srv.request.name = <span class="string">&quot;turtle2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求服务调用</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Call service to spwan turtle[x:%0.6f, y:%0.6f, name:%s]&quot;</span>, </span><br><span class="line">			 srv.request.x, srv.request.y, srv.request.name.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	add_turtle.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示服务调用结果</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Spwan turtle successfully [name:%s]&quot;</span>, srv.response.name.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="2-服务端编程实现"><a href="#2-服务端编程实现" class="headerlink" title="2.服务端编程实现"></a>2.服务端编程实现</h2><p>在这一节，我们实现这样一个功能，就是客户端向服务端发送一个请求，让服务端来控制海龟。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055617.png" alt="image-20211005235128008"></p>
<p>这里面，这个服务叫做/turtle_command，发送的request数据类型为std_srvs::Trigger。</p>
<p>服务端的程序主要有以下几部分组成：</p>
<ul>
<li>初始化ROS节点</li>
<li>创建Server实例</li>
<li>循环等待服务请求，进入回调函数</li>
<li>在回调函数中完成服务功能的处理，并反馈应答数据</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_srvs/Trigger.h&gt;</span><span class="comment">//服务数据类型的头文件</span></span></span><br><span class="line"></span><br><span class="line">ros::Publisher turtle_vel_pub;</span><br><span class="line"><span class="keyword">bool</span> pubCommand = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// service回调函数，输入参数req，输出参数res</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">commandCallback</span><span class="params">(std_srvs::Trigger::Request  &amp;req,<span class="comment">//客户端发送的请求</span></span></span></span><br><span class="line"><span class="params"><span class="function">         			std_srvs::Trigger::Response &amp;res)</span><span class="comment">//服务端的回应</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	pubCommand = !pubCommand;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示请求数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish turtle velocity command [%s]&quot;</span>, pubCommand==<span class="literal">true</span>?<span class="string">&quot;Yes&quot;</span>:<span class="string">&quot;No&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置反馈数据</span></span><br><span class="line">	res.success = <span class="literal">true</span>;</span><br><span class="line">	res.message = <span class="string">&quot;Change turtle command state!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;turtle_command_server&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个名为/turtle_command的server，注册回调函数commandCallback</span></span><br><span class="line">    ros::ServiceServer command_service = n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/turtle_command&quot;</span>, commandCallback);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10</span></span><br><span class="line">	turtle_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to receive turtle command.&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置循环的频率</span></span><br><span class="line">	<span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 查看一次回调函数队列</span></span><br><span class="line">    	ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 如果标志为true，则发布速度指令</span></span><br><span class="line">		<span class="keyword">if</span>(pubCommand)</span><br><span class="line">		&#123;</span><br><span class="line">			geometry_msgs::Twist vel_msg;</span><br><span class="line">			vel_msg.linear.x = <span class="number">0.5</span>;</span><br><span class="line">			vel_msg.angular.z = <span class="number">0.2</span>;</span><br><span class="line">			turtle_vel_pub.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//按照循环频率延时</span></span><br><span class="line">	    loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段程序运行的过程是这样的，先是创建好Server和Publisher，然后等待请求，当有请求指令时，立即跳入到回调函数。回调函数中设置了输入数据的类型为std_srvs::Trigger::Request，当有这种类型的数据输入时，才跳入回调函数（在本例中，Request是空的，所以可以不用输入内容）。进入到回调函数后，pubCommand变为真，这在主函数的循环中，if语句开始执行，将发送话题数据twist，控制海龟移动。</p>
<p>呼叫服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosservice 		call 		/turtle_command </span><br></pre></td></tr></table></figure>
<h2 id="3-服务数据的定义与使用"><a href="#3-服务数据的定义与使用" class="headerlink" title="3.服务数据的定义与使用"></a>3.服务数据的定义与使用</h2><p>上一节我们用的服务数据为Trigger，这是ROS定义好的，我们现在来自己定义一个服务的数据。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055634.png" alt="image-20211006003654128"></p>
<p>我们要实现的功能如上所示，我们自己定义一个服务消息数据为Person，客户端可以发送请求，获得show_person服务，服务端发出一个回应。</p>
<h3 id="1-定义数据"><a href="#1-定义数据" class="headerlink" title="(1)定义数据"></a>(1)定义数据</h3><p>请求数据和回应数据中间用<code>---</code>来隔开，和话题消息数据定义一样，我们用写在一个纯文本文件中，文件格式为.srv。</p>
<p>先在功能包目录下建立一个文件夹srv。然后创建.srv文件。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055638.png" alt="image-20211006004641504"></p>
<h3 id="2-编辑配置文件-1"><a href="#2-编辑配置文件-1" class="headerlink" title="(2)编辑配置文件"></a>(2)编辑配置文件</h3><p>与话题消息几乎一样，只不过在CMakeLists中，话题消息的配置使用的是add_message_files(FILES Person.msg)，而在服务数据的配置使用的是add_service_files(FILES Person.srv)。</p>
<p><strong>首先要在package.xml中添加功能包依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055644.png" alt="image-20211005185240266"></p>
<p><strong>然后在CMakeLists添加相关配置</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation <span class="comment">#这个是后加的</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>如下图：</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055649.png" alt="image-20211005185707368"></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_service_files(FILES 	Person.srv)<span class="comment">#配置msg源文件</span></span><br><span class="line">generate_messages(DEPENDENCIES		std_msgs)<span class="comment">#生成消息时依赖于std_msgs</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES learning_topic</span></span><br><span class="line">  CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="3-使用-1"><a href="#3-使用-1" class="headerlink" title="(3)使用"></a>(3)使用</h3><p>最后就是编译了，在工作空间目录下使用<code>catkin_make</code> 命令完成。生成的文件在devel/include中。</p>
<p><strong>客户端：person_client.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;learning_service/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_client&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">	ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/show_person&quot;</span>);</span><br><span class="line">	ros::ServiceClient person_client = node.serviceClient&lt;learning_service::Person&gt;(<span class="string">&quot;/show_person&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化learning_service::Person的请求数据</span></span><br><span class="line">	learning_service::Person srv;</span><br><span class="line">	srv.request.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">	srv.request.age  = <span class="number">20</span>;</span><br><span class="line">	srv.request.sex  = learning_service::Person::Request::male;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求服务调用</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Call service to show person[name:%s, age:%d, sex:%d]&quot;</span>, </span><br><span class="line">			 srv.request.name.<span class="built_in">c_str</span>(), srv.request.age, srv.request.sex);</span><br><span class="line"></span><br><span class="line">	person_client.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示服务调用结果</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Show person result : %s&quot;</span>, srv.response.result.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>服务端：person_server.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将执行/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;learning_service/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// service回调函数，输入参数req，输出参数res</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">personCallback</span><span class="params">(learning_service::Person::Request  &amp;req,</span></span></span><br><span class="line"><span class="params"><span class="function">         			learning_service::Person::Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 显示请求数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Person: name:%s  age:%d  sex:%d&quot;</span>, req.name.<span class="built_in">c_str</span>(), req.age, req.sex);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置反馈数据</span></span><br><span class="line">	res.result = <span class="string">&quot;OK&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_server&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个名为/show_person的server，注册回调函数personCallback</span></span><br><span class="line">    ros::ServiceServer person_service = n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/show_person&quot;</span>, personCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to show person informtion.&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译，在CMakeLists中加入：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(person_client src/person_client.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_client <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_client <span class="variable">$&#123;PROJECT_NAME&#125;</span>_gencpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(person_server src/person_server.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_server <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_server <span class="variable">$&#123;PROJECT_NAME&#125;</span>_gencpp)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="七、参数的使用与编程方法"><a href="#七、参数的使用与编程方法" class="headerlink" title="七、参数的使用与编程方法"></a>七、参数的使用与编程方法</h1><p>ROS Master中有一个参数服务器，它可以存储全局参数，各个节点都可以访问（不同的主机也可访问）。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055707.png" alt="image-20211006011750764"></p>
<p>还是创建一个节点来实现用程序使用全局参数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程设置/读取海龟例程中的参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_srvs/Empty.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> red, green, blue;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;parameter_config&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取背景颜色参数</span></span><br><span class="line">	ros::param::<span class="built_in">get</span>(<span class="string">&quot;/turtlesim/background_r&quot;</span>, red);</span><br><span class="line">	ros::param::<span class="built_in">get</span>(<span class="string">&quot;/turtlesim/background_g&quot;</span>, green);</span><br><span class="line">	ros::param::<span class="built_in">get</span>(<span class="string">&quot;/turtlesim/background_b&quot;</span>, blue);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Get Backgroud Color[%d, %d, %d]&quot;</span>, red, green, blue);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置背景颜色参数</span></span><br><span class="line">	ros::param::<span class="built_in">set</span>(<span class="string">&quot;/turtlesim/background_r&quot;</span>, <span class="number">255</span>);</span><br><span class="line">	ros::param::<span class="built_in">set</span>(<span class="string">&quot;/turtlesim/background_g&quot;</span>, <span class="number">255</span>);</span><br><span class="line">	ros::param::<span class="built_in">set</span>(<span class="string">&quot;/turtlesim/background_b&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Set Backgroud Color[255, 255, 255]&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取背景颜色参数</span></span><br><span class="line">	ros::param::<span class="built_in">get</span>(<span class="string">&quot;/turtlesim/background_r&quot;</span>, red);</span><br><span class="line">	ros::param::<span class="built_in">get</span>(<span class="string">&quot;/turtlesim/background_g&quot;</span>, green);</span><br><span class="line">	ros::param::<span class="built_in">get</span>(<span class="string">&quot;/turtlesim/background_b&quot;</span>, blue);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Re-get Backgroud Color[%d, %d, %d]&quot;</span>, red, green, blue);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用服务，刷新背景颜色</span></span><br><span class="line">	ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/clear&quot;</span>);</span><br><span class="line">	ros::ServiceClient clear_background = node.serviceClient&lt;std_srvs::Empty&gt;(<span class="string">&quot;/clear&quot;</span>);</span><br><span class="line">	std_srvs::Empty srv;</span><br><span class="line">	clear_background.<span class="built_in">call</span>(srv);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="八、ROS中的常用组件"><a href="#八、ROS中的常用组件" class="headerlink" title="八、ROS中的常用组件"></a>八、ROS中的常用组件</h1><h2 id="1-坐标变换管理系统-TF功能包"><a href="#1-坐标变换管理系统-TF功能包" class="headerlink" title="1.坐标变换管理系统-TF功能包"></a>1.坐标变换管理系统-TF功能包</h2><p>TF功能包能管理机器人中的各个坐标系之间的变换关系。</p>
<p>TF可以在分布式系统中进行操作，也就是说，一个机器人系统中所有的坐标变换关系，对于所有的节点组件都是可用的，所有订阅TF消息的节点都会缓冲一份所有坐标系的变换关系数据，所以这种结构不需要中心服务器来存储任何数据。</p>
<p>想要使用TF功能包，需要一下两个步骤：</p>
<ul>
<li>广播TF变换：向系统中广播坐标系之间的变换关系。就是通过节点，根据自身的位置和对方的位置，计算出变换关系。</li>
<li>监听TF变换：接收并缓存系统中发布的所有坐标变换数据，并从中查询所需要的坐标变换关系。</li>
</ul>
<p>在ROS中，使用树结构来进行管理。</p>
<p>例如一个小车，小车的中心点为base_link坐标系原点，上面有一个激光雷达，激光雷达中心为base_laser坐标系原点。</p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055714.png" alt="image-20211006021136321"></p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055717.png" alt="image-20211006021150776"></p>
<h3 id="1-一个例程"><a href="#1-一个例程" class="headerlink" title="(1)一个例程"></a>(1)一个例程</h3><p>在ROS中有一个例程，海龟跟踪，这个就是通过TF坐标来实现的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo 	apt-get		install		ros-melodic-turtle-tf  //下载例程文件</span><br><span class="line">roslaunch  	turtle_tf	turtle_tf_demo.launch //roslaunch命令是启动.launch文件，这个文件中包括了很多个节点</span><br><span class="line">rosrun 		turtlesim		turtle_teleop_key //启动键盘控制</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun 		tf		view_frames  //运行tf的一个可视化工具，会在当前路径下生成pdf文件，来表示当前坐标系关系</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055724.png" alt="image-20211006023541876"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf		tf_echo		turtle1		turtle2  //显示两个坐标系间的关系</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055729.png" alt="image-20211006023636826"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun 	rviz	 rviz 	-d 		&#x27;rospack find turtle_tf&#x27;/rviz/turtle_rviz.rviz		//运行rviz可视化工具，可以查看坐标关系</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055732.png" alt="image-20211006023829401" style="zoom:50%;" /></p>
<h3 id="2-创建TF广播器"><a href="#2-创建TF广播器" class="headerlink" title="(2)创建TF广播器"></a>(2)创建TF广播器</h3><p>首先，我们需要创建一个发布乌龟坐标系和世界坐标系之间TF变换的节点。然后这个节点可以把坐标变换关系发送到TF树中。</p>
<ul>
<li>定义TF广播器</li>
<li>创建坐标变换值</li>
<li>发布坐标变换</li>
</ul>
<p>代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程产生tf数据，并计算、发布turtle2的速度指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tf/transform_broadcaster.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;turtlesim/Pose.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::string turtle_name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">poseCallback</span><span class="params">(<span class="keyword">const</span> turtlesim::PoseConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 创建tf的广播器</span></span><br><span class="line">	<span class="keyword">static</span> tf::TransformBroadcaster br;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化tf数据</span></span><br><span class="line">	tf::Transform transform;<span class="comment">//坐标变换矩阵4*4</span></span><br><span class="line">	transform.<span class="built_in">setOrigin</span>( tf::<span class="built_in">Vector3</span>(msg-&gt;x, msg-&gt;y, <span class="number">0.0</span>) );<span class="comment">//设置平移</span></span><br><span class="line">	tf::Quaternion q;</span><br><span class="line">	q.<span class="built_in">setRPY</span>(<span class="number">0</span>, <span class="number">0</span>, msg-&gt;theta);<span class="comment">//设置四元数</span></span><br><span class="line">	transform.<span class="built_in">setRotation</span>(q);<span class="comment">//设置旋转</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 广播world与海龟坐标系之间的tf数据</span></span><br><span class="line">	br.<span class="built_in">sendTransform</span>(tf::<span class="built_in">StampedTransform</span>(transform, ros::Time::<span class="built_in">now</span>(), <span class="string">&quot;world&quot;</span>, turtle_name));<span class="comment">//将坐标变换关系发送到坐标树</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;my_tf_broadcaster&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输入参数作为海龟的名字</span></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ROS_ERROR</span>(<span class="string">&quot;need turtle name as argument&quot;</span>); </span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	turtle_name = argv[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 订阅海龟的位姿话题</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line">	ros::Subscriber sub = node.<span class="built_in">subscribe</span>(turtle_name+<span class="string">&quot;/pose&quot;</span>, <span class="number">10</span>, &amp;poseCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">	ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-创建TF监听器"><a href="#3-创建TF监听器" class="headerlink" title="(3)创建TF监听器"></a>(3)创建TF监听器</h3><p>监听器的作用就是从TF树中获取坐标变换关系。</p>
<ul>
<li>定义TF监听器</li>
<li>查找坐标变换</li>
</ul>
<p>现在我们从TF树中获取turtle2相对于turtle1的坐标变换，从而控制turtle2的移动。代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程监听tf数据，并计算、发布turtle2的速度指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tf/transform_listener.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;turtlesim/Spawn.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;my_tf_listener&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求产生turtle2</span></span><br><span class="line">	ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	ros::ServiceClient add_turtle = node.serviceClient&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	turtlesim::Spawn srv;</span><br><span class="line">	add_turtle.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建发布turtle2速度控制指令的发布者</span></span><br><span class="line">	ros::Publisher turtle_vel = node.advertise&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle2/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建tf的监听器</span></span><br><span class="line">	tf::TransformListener listener;</span><br><span class="line"></span><br><span class="line">	<span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10.0</span>)</span></span>;</span><br><span class="line">	<span class="keyword">while</span> (node.<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 获取turtle1与turtle2坐标系之间的tf数据</span></span><br><span class="line">		tf::StampedTransform transform;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			listener.<span class="built_in">waitForTransform</span>(<span class="string">&quot;/turtle2&quot;</span>, <span class="string">&quot;/turtle1&quot;</span>, ros::<span class="built_in">Time</span>(<span class="number">0</span>), ros::<span class="built_in">Duration</span>(<span class="number">3.0</span>));<span class="comment">//等待TF数据，看系统中是否有这个数据。</span></span><br><span class="line">			listener.<span class="built_in">lookupTransform</span>(<span class="string">&quot;/turtle2&quot;</span>, <span class="string">&quot;/turtle1&quot;</span>, ros::<span class="built_in">Time</span>(<span class="number">0</span>), transform);<span class="comment">//查询数据，结果保存到transform里</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in"><span class="keyword">catch</span></span> (tf::TransformException &amp;ex) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ROS_ERROR</span>(<span class="string">&quot;%s&quot;</span>,ex.<span class="built_in">what</span>());</span><br><span class="line">			ros::<span class="built_in">Duration</span>(<span class="number">1.0</span>).<span class="built_in">sleep</span>();</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 根据turtle1与turtle2坐标系之间的位置关系，发布turtle2的速度控制指令</span></span><br><span class="line">		geometry_msgs::Twist vel_msg;</span><br><span class="line">		vel_msg.angular.z = <span class="number">4.0</span> * <span class="built_in">atan2</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">y</span>(),</span><br><span class="line">				                        transform.<span class="built_in">getOrigin</span>().<span class="built_in">x</span>());</span><br><span class="line">		vel_msg.linear.x = <span class="number">0.5</span> * <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">x</span>(), <span class="number">2</span>) +</span><br><span class="line">				                      <span class="built_in">pow</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">y</span>(), <span class="number">2</span>));</span><br><span class="line">		turtle_vel.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line"></span><br><span class="line">		rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="2-Launch文件"><a href="#2-Launch文件" class="headerlink" title="2.Launch文件"></a>2.Launch文件</h2><p>前面我们每启动一个节点，都需要在终端中输入一个命令，这十分麻烦，我们可以用启动文件来进行运行，这样一次就可以启动多个节点，还可以自动启动ROS Master节点管理器，并实现每个节点的各种配置。</p>
<p>Launch文件是一个.XML文件。它可以自动启动ROS Master。</p>
<h3 id="1-根元素"><a href="#1-根元素" class="headerlink" title="(1)根元素"></a>(1)根元素</h3><p>XML文件中必须包含一个根元素，采用<code>&lt;launch&gt;</code>标签定义，文件中其他的内容都必须在这个标签内。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">其他内容</span><br><span class="line">&lt;\launch&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-节点元素"><a href="#2-节点元素" class="headerlink" title="(2)节点元素"></a>(2)节点元素</h3><p>采用节点标签定义。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span>	<span class="attr">pkg</span>=<span class="string">&quot;功能包名字&quot;</span>   <span class="attr">type</span>=<span class="string">&quot;可执行文件名字&quot;</span>	<span class="attr">name</span>=<span class="string">&quot;节点名字&quot;</span>		/&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意这三个属性是最基本的属性，后面节点的名字是定义运行该可执行文件产生的节点名字，会覆盖节点中init()赋予的节点名字。</p>
<p>在节点元素中，我们还可以增加其他属性。</p>
<p><code>output=&quot;screen&quot;</code> ：讲节点的标准输出打印到终端屏幕，默认输出为日志文档。</p>
<p><code>respawn=&quot;true&quot;</code>：复位属性，该节点停止时，会自动重启，默认为false。</p>
<p><code>required=&quot;true&quot;</code> ：必要节点，该节点终止时，launch文件中的其他节点也被终止。</p>
<p><code>ns=&quot;namespace&quot;</code> ：命名空间，为节点内的相对名称添加命名空间前缀。</p>
<p><code>args=&quot;arguments&quot;</code> ：节点需要的输入参数。</p>
<h3 id="3-参数元素"><a href="#3-参数元素" class="headerlink" title="(3)参数元素"></a>(3)参数元素</h3><p>为了方便全局参数的修改和设置，我们使用参数设置标签<code>&lt;param&gt;</code> 或 <code>&lt;rosparam&gt;</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">param</span> 		<span class="attr">name</span>=<span class="string">&quot;参数名字&quot;</span>		<span class="attr">value</span>=<span class="string">&quot;设置参数值&quot;</span>   /&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是还是觉得一条一条的打很麻烦，我们还可以用加载参数文件的方式。</p>
<p><code>&lt;rosparam&gt;</code> 可以帮助我们将一个YAML格式文件中的参数全部加载到ROS参数服务器中，需要设置command属性为”load”，还可以设置命名空间”ns”。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rosparam</span>  	<span class="attr">file</span>=<span class="string">&quot;文件名.YAML&quot;</span>		<span class="attr">command</span>=<span class="string">&quot;load&quot;</span>		<span class="attr">ns</span>=<span class="string">&quot;命名空间&quot;</span>		/&gt;</span></span><br></pre></td></tr></table></figure>
<p>还有一个参数，就是launch文件中的参数，类似于文件内部的局部变量，仅限于在launch文件中使用，与ROS的参数无关。我们可以用<code>&lt;arg&gt;</code> 来设置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">arg</span> 	<span class="attr">name</span>=<span class="string">&quot;参数名&quot;</span>		<span class="attr">default</span>=<span class="string">&quot;参数值&quot;</span>	/&gt;</span>   //设置参数</span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> 		<span class="attr">name</span>=<span class="string">&quot;foo&quot;</span>		<span class="attr">value</span>=<span class="string">&quot;$&#123;arg		设置的参数名&#125;&quot;</span>	/&gt;</span>		//使用这个参数</span><br></pre></td></tr></table></figure>
<h3 id="4-重映射机制"><a href="#4-重映射机制" class="headerlink" title="(4)重映射机制"></a>(4)重映射机制</h3><p>在别人的功能包的接口和自己要用的不一样的时候，我们可以将这个功能包改一个名字。例如，turtlebot的键盘控制节点发布的速度指令话题为/turtlebot/cmd_vel，但是我们的机器人订阅的速度控制话题是/cmd_vel，这是使用<code>&lt;remap&gt;</code> 就可以进行重映射。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">remap</span>	<span class="attr">from</span>=<span class="string">&quot;/turtlebot/cmd_vel&quot;</span>	<span class="attr">to</span>=<span class="string">&quot;/cmd_vel&quot;</span>	/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-嵌套复用"><a href="#5-嵌套复用" class="headerlink" title="(5)嵌套复用"></a>(5)嵌套复用</h3><p>在复杂系统中，launch文件往往有很多，这些launch文件之间也可能会存在依赖关系，如果要直接服用一个已有launch文件中的内容，可以使用<code>&lt;include&gt;</code> 标签包含其他launch文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span>	<span class="attr">file</span>=<span class="string">&quot;$&#123;dirname&#125;/other.launch&quot;</span>	/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-使用"><a href="#6-使用" class="headerlink" title="(6)使用"></a>(6)使用</h3><p>写好launch文件后，将其放在名为launch的文件夹中，然后在工作空间目录打开终端，使用<code>catkin_make</code> 进行编译，然后使用<code>roslaunch</code>直接运行launch文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch	功能包		launch文件</span><br></pre></td></tr></table></figure>
<h2 id="3-QT工具箱"><a href="#3-QT工具箱" class="headerlink" title="3.QT工具箱"></a>3.QT工具箱</h2><p>为了方便可视化调试和显示，ROS提供了QT工具箱。</p>
<p>以<code>rqt</code> 开头的命令即为QT工具的命令。</p>
<p><code>rqt_graph</code>     显示系统的计算图，通过这张图可以了解整个系统的全貌。</p>
<p><code>rqt_console</code>     显示工作日志信息。</p>
<p><code>rqt_plot</code>     数据绘图工具。</p>
<p><code>rosrun     rqt_reconfigure    rqt_reconfigure</code>    参数动态配置，可以在不重启系统时，动态配置ROS系统中的参数。</p>
<p><code>rqt_imag</code>     有摄像头时，显示图像。</p>
<p><code>rqt</code>    所有工具的集合窗口，在界面中选择工具。</p>
<h2 id="4-rviz三维可视化平台"><a href="#4-rviz三维可视化平台" class="headerlink" title="4.rviz三维可视化平台"></a>4.rviz三维可视化平台</h2><p>启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun	rviz	rviz</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055751.png" alt="image-20211007011943519"></p>
<h2 id="5-Gazebo"><a href="#5-Gazebo" class="headerlink" title="5.Gazebo"></a>5.Gazebo</h2><p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055810.png" alt="image-20211007012012849"></p>
<p><img src="https://raw.githubusercontent.com/PiggyHero/Blog_Picture/master/20211018055801.png" alt="image-20211007012025774"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ROS/" rel="tag"># ROS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/10/18/Ubuntu%E7%9A%84%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" rel="prev" title="Ubuntu的使用手册">
      <i class="fa fa-chevron-left"></i> Ubuntu的使用手册
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/10/18/Markdown%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95/" rel="next" title="Markdown常用语法">
      Markdown常用语法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81ROS%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">一、ROS是什么</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="nav-text">1.通信机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="nav-text">2.开发工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%BA%94%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="nav-text">3.应用功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%94%9F%E6%80%81%E7%8E%AF%E5%A2%83"><span class="nav-text">4.生态环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81ROS%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">二、ROS中的核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%BB%84%E6%88%90ROS%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8D%95%E5%85%83"><span class="nav-text">1.组成ROS的基本单元</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%8A%82%E7%82%B9-Node-%E2%80%94%E5%B7%A5%E4%BA%BA"><span class="nav-text">(1)节点(Node)—工人</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%8A%82%E7%82%B9%E7%AE%A1%E7%90%86%E5%99%A8-Ros-Master-%E2%80%94%E7%AE%A1%E7%90%86%E5%91%98"><span class="nav-text">(2)节点管理器(Ros Master)—管理员</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="nav-text">2.通信机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%BC%82%E6%AD%A5%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="nav-text">(1)异步通信机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E8%AF%9D%E9%A2%98-Topic"><span class="nav-text">a.话题(Topic)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E6%B6%88%E6%81%AF-Message"><span class="nav-text">b.消息(Message)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%90%8C%E6%AD%A5%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="nav-text">(2)同步通信机制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8F%82%E6%95%B0%E2%80%94%E5%85%A8%E5%B1%80%E5%85%B1%E4%BA%AB%E5%AD%97%E5%85%B8"><span class="nav-text">3.参数—全局共享字典</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-text">4.文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8A%9F%E8%83%BD%E5%8C%85-Package"><span class="nav-text">(1)功能包(Package)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8A%9F%E8%83%BD%E5%8C%85%E6%B8%85%E5%8D%95-Package-Manifest"><span class="nav-text">(2)功能包清单(Package Manifest)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%85%83%E5%8A%9F%E8%83%BD%E5%8C%85-Meta-Package"><span class="nav-text">(3)元功能包(Meta Package)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81ROS%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="nav-text">三、ROS命令行工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="nav-text">1.基本命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%8A%82%E7%82%B9%E5%91%BD%E4%BB%A4"><span class="nav-text">2.节点命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rosnode-list"><span class="nav-text">(1)rosnode list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-rosnode-info-%E8%8A%82%E7%82%B9%E5%90%8D"><span class="nav-text">(2)rosnode info 节点名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%AF%9D%E9%A2%98%E5%91%BD%E4%BB%A4"><span class="nav-text">3.话题命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rostopic-list"><span class="nav-text">(1)rostopic list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-rostopic-pub"><span class="nav-text">(2)rostopic pub</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E8%AF%9D%E9%A2%98%E6%B6%88%E6%81%AF%E5%91%BD%E4%BB%A4"><span class="nav-text">4.话题消息命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rosmsg-show"><span class="nav-text">(1)rosmsg show</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-text"> </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%9C%8D%E5%8A%A1%E5%91%BD%E4%BB%A4"><span class="nav-text">5.服务命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rosservice-list"><span class="nav-text">(1)rosservice list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-rosservice-call"><span class="nav-text">(2)rosservice call</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%9C%8D%E5%8A%A1%E6%B6%88%E6%81%AF%E5%91%BD%E4%BB%A4"><span class="nav-text">6.服务消息命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rossrv-show"><span class="nav-text">(1)rossrv show</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E8%AF%9D%E9%A2%98%E8%AE%B0%E5%BD%95%E5%92%8C%E5%A4%8D%E7%8E%B0"><span class="nav-text">7.话题记录和复现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rosbag-record"><span class="nav-text">(1)rosbag record</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-rosbag-play"><span class="nav-text">(2)rosbag play</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E5%8F%82%E6%95%B0%E5%91%BD%E4%BB%A4"><span class="nav-text">8.参数命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rosparam-list"><span class="nav-text">(1)rosparam list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-rosparam-get"><span class="nav-text">(2)rosparam get</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-rosparam-set"><span class="nav-text">(3)rosparam set</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-rosparam-dump"><span class="nav-text">(4)rosparam dump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-rosparam-load"><span class="nav-text">(5)rosparam load</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-rosparam-delete"><span class="nav-text">(6)rosparam delete</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E4%B8%8E%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="nav-text">四、创建工作空间与功能包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4"><span class="nav-text">1.创建工作空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="nav-text">2.创建功能包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%AF%9D%E9%A2%98%E4%B8%AD%E5%90%84%E9%83%A8%E5%88%86%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">五、话题中各部分的编程实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%8F%91%E5%B8%83%E8%80%85%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.发布者编程实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BC%96%E5%86%99%E7%A8%8B%E5%BA%8F%E4%B9%8B%E5%89%8D"><span class="nav-text">(1)编写程序之前</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="nav-text">(2)代码实现过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BC%96%E8%AF%91%E4%BB%A3%E7%A0%81"><span class="nav-text">(3)编译代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">(4)配置环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E8%BF%90%E8%A1%8C"><span class="nav-text">(5)运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%AE%A2%E9%98%85%E8%80%85%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">2.订阅者编程实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%9D%E9%A2%98%E6%B6%88%E6%81%AF%E7%BB%93%E6%9E%84"><span class="nav-text">3.自定义话题消息结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%9A%E4%B9%89msg%E6%96%87%E4%BB%B6"><span class="nav-text">(1)定义msg文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">(2)编辑配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BD%BF%E7%94%A8"><span class="nav-text">(3)使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%90%84%E9%83%A8%E5%88%86%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">六、服务中各部分的编程实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.客户端编程实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">2.服务端编程实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-text">3.服务数据的定义与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE"><span class="nav-text">(1)定义数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="nav-text">(2)编辑配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BD%BF%E7%94%A8-1"><span class="nav-text">(3)使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%BC%96%E7%A8%8B%E6%96%B9%E6%B3%95"><span class="nav-text">七、参数的使用与编程方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81ROS%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="nav-text">八、ROS中的常用组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-TF%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="nav-text">1.坐标变换管理系统-TF功能包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%80%E4%B8%AA%E4%BE%8B%E7%A8%8B"><span class="nav-text">(1)一个例程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%88%9B%E5%BB%BATF%E5%B9%BF%E6%92%AD%E5%99%A8"><span class="nav-text">(2)创建TF广播器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%88%9B%E5%BB%BATF%E7%9B%91%E5%90%AC%E5%99%A8"><span class="nav-text">(3)创建TF监听器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Launch%E6%96%87%E4%BB%B6"><span class="nav-text">2.Launch文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A0%B9%E5%85%83%E7%B4%A0"><span class="nav-text">(1)根元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%8A%82%E7%82%B9%E5%85%83%E7%B4%A0"><span class="nav-text">(2)节点元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%8F%82%E6%95%B0%E5%85%83%E7%B4%A0"><span class="nav-text">(3)参数元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E9%87%8D%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="nav-text">(4)重映射机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%B5%8C%E5%A5%97%E5%A4%8D%E7%94%A8"><span class="nav-text">(5)嵌套复用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E4%BD%BF%E7%94%A8"><span class="nav-text">(6)使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-QT%E5%B7%A5%E5%85%B7%E7%AE%B1"><span class="nav-text">3.QT工具箱</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-rviz%E4%B8%89%E7%BB%B4%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0"><span class="nav-text">4.rviz三维可视化平台</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Gazebo"><span class="nav-text">5.Gazebo</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="PiggyHero"
      src="/images/cutexiaoxin.gif">
  <p class="site-author-name" itemprop="name">PiggyHero</p>
  <div class="site-description" itemprop="description">不学习咋整啊！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/PiggyHero" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PiggyHero" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:a363158526@gmail.com" title="E-Mail → mailto:a363158526@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PiggyHero</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>-->


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
